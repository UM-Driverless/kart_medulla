<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>KM_Medulla: main.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">KM_Medulla<span id="projectnumber">&#160;1.0</span>
   </div>
   <div id="projectbrief">Code for an ESP32 integrated into a self-driving kart</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_5c982d53a68cdbcd421152b4020263a9.html">main</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle"><div class="title">main.c File Reference</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &quot;nvs_flash.h&quot;</code><br />
<code>#include &quot;esp_system.h&quot;</code><br />
<code>#include &quot;esp_log.h&quot;</code><br />
<code>#include &quot;esp_bt.h&quot;</code><br />
<code>#include &lt;btstack_port_esp32.h&gt;</code><br />
<code>#include &lt;btstack_run_loop.h&gt;</code><br />
<code>#include &lt;btstack_stdio_esp32.h&gt;</code><br />
<code>#include &lt;uni.h&gt;</code><br />
<code>#include &quot;esp_timer.h&quot;</code><br />
<code>#include &quot;esp_wifi.h&quot;</code><br />
<code>#include &quot;esp_event.h&quot;</code><br />
<code>#include &quot;esp_netif.h&quot;</code><br />
<code>#include &quot;esp_sntp.h&quot;</code><br />
<code>#include &quot;km_act.h&quot;</code><br />
<code>#include &quot;<a class="el" href="km__coms_8h_source.html">km_coms.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="km__gamc_8h_source.html">km_gamc.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="km__pid_8h_source.html">km_pid.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="km__rtos_8h_source.html">km_rtos.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="km__sdir_8h_source.html">km_sdir.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="km__sta_8h_source.html">km_sta.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="km__gpio_8h_source.html">km_gpio.h</a>&quot;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for main.c:</div>
<div class="dyncontent">
<div class="center"><img src="main_8c__incl.png" border="0" usemap="#amain_8c" alt=""/></div>
<map name="amain_8c" id="amain_8c">
<area shape="rect" title=" " alt="" coords="1252,5,1319,31"/>
<area shape="rect" title=" " alt="" coords="266,79,361,104"/>
<area shape="poly" title=" " alt="" coords="1252,23,900,37,643,54,375,81,374,76,643,49,900,31,1252,17"/>
<area shape="rect" title=" " alt="" coords="385,79,497,104"/>
<area shape="poly" title=" " alt="" coords="1252,24,950,42,736,59,516,81,511,82,511,77,516,76,735,54,950,37,1252,18"/>
<area shape="rect" title=" " alt="" coords="849,152,933,177"/>
<area shape="poly" title=" " alt="" coords="1252,21,1194,23,1120,31,1040,49,1001,63,964,81,930,109,906,142,902,139,927,106,961,76,999,58,1038,44,1119,25,1194,17,1252,16"/>
<area shape="rect" title=" " alt="" coords="1353,79,1431,104"/>
<area shape="poly" title=" " alt="" coords="1304,28,1365,69,1362,73,1301,33"/>
<area shape="rect" title=" " alt="" coords="1455,79,1617,104"/>
<area shape="poly" title=" " alt="" coords="1320,26,1483,72,1482,77,1318,31"/>
<area shape="rect" title=" " alt="" coords="1641,79,1786,104"/>
<area shape="poly" title=" " alt="" coords="1319,22,1631,74,1631,79,1318,28"/>
<area shape="rect" title=" " alt="" coords="1810,79,1977,104"/>
<area shape="poly" title=" " alt="" coords="1319,21,1796,76,1796,81,1319,26"/>
<area shape="rect" title=" " alt="" coords="2001,79,2055,104"/>
<area shape="poly" title=" " alt="" coords="1319,17,1429,20,1592,29,1786,47,1987,76,1987,81,1786,52,1592,35,1429,26,1319,22"/>
<area shape="rect" title=" " alt="" coords="1152,152,1251,177"/>
<area shape="poly" title=" " alt="" coords="1274,33,1253,54,1233,80,1219,110,1210,139,1204,138,1214,108,1228,77,1249,50,1270,29"/>
<area shape="rect" title=" " alt="" coords="2079,79,2166,104"/>
<area shape="poly" title=" " alt="" coords="1319,18,1621,33,1839,50,2066,76,2065,81,1838,55,1621,38,1319,23"/>
<area shape="rect" title=" " alt="" coords="2191,79,2292,104"/>
<area shape="poly" title=" " alt="" coords="1319,18,1663,32,1915,50,2177,76,2176,81,1914,55,1663,38,1319,23"/>
<area shape="rect" title=" " alt="" coords="2316,79,2409,104"/>
<area shape="poly" title=" " alt="" coords="1319,17,1471,20,1711,29,2000,47,2302,76,2302,81,2000,52,1710,34,1471,25,1319,22"/>
<area shape="rect" title=" " alt="" coords="2434,79,2526,104"/>
<area shape="poly" title=" " alt="" coords="1319,17,1486,19,1755,27,2081,45,2252,58,2421,76,2420,81,2251,64,2080,50,1754,32,1486,24,1319,22"/>
<area shape="rect" title=" " alt="" coords="2551,79,2633,104"/>
<area shape="poly" title=" " alt="" coords="1319,16,1501,16,1798,22,2160,40,2350,56,2537,76,2537,81,2349,61,2160,46,1798,28,1501,22,1319,22"/>
<area shape="rect" href="km__coms_8h.html" title=" " alt="" coords="573,79,670,104"/>
<area shape="poly" title=" " alt="" coords="1252,24,1019,43,855,60,684,81,683,76,855,55,1018,38,1252,19"/>
<area shape="rect" href="km__gpio_8h.html" title=" " alt="" coords="448,152,539,177"/>
<area shape="poly" title=" " alt="" coords="1252,23,879,42,675,59,602,69,561,81,544,93,529,108,507,141,503,138,525,105,541,89,559,76,601,64,675,54,878,36,1252,18"/>
<area shape="rect" href="km__gamc_8h.html" title=" " alt="" coords="695,79,793,104"/>
<area shape="poly" title=" " alt="" coords="1252,25,1067,46,808,81,807,76,1066,41,1251,20"/>
<area shape="rect" href="km__pid_8h.html" title=" " alt="" coords="1084,79,1167,104"/>
<area shape="poly" title=" " alt="" coords="1261,33,1165,75,1163,71,1259,28"/>
<area shape="rect" href="km__rtos_8h.html" title=" " alt="" coords="1242,79,1329,104"/>
<area shape="poly" title=" " alt="" coords="1288,31,1288,65,1283,65,1283,31"/>
<area shape="rect" href="km__sdir_8h.html" title=" " alt="" coords="975,79,1060,104"/>
<area shape="poly" title=" " alt="" coords="1253,31,1074,78,1072,73,1251,26"/>
<area shape="rect" href="km__sta_8h.html" title=" " alt="" coords="817,79,900,104"/>
<area shape="poly" title=" " alt="" coords="1252,27,919,81,915,82,914,77,918,76,1251,22"/>
<area shape="poly" title=" " alt="" coords="665,101,836,146,835,151,664,107"/>
<area shape="poly" title=" " alt="" coords="602,106,528,147,525,143,599,102"/>
<area shape="rect" href="km__objects_8h.html" title=" " alt="" coords="613,152,723,177"/>
<area shape="poly" title=" " alt="" coords="631,103,655,139,651,142,627,106"/>
<area shape="rect" title=" " alt="" coords="857,225,927,251"/>
<area shape="poly" title=" " alt="" coords="615,106,599,140,597,159,604,176,628,200,653,214,679,221,706,222,768,219,804,218,843,223,843,228,803,224,768,224,706,228,678,226,651,219,625,204,599,179,592,160,594,139,610,103"/>
<area shape="rect" title=" " alt="" coords="5,225,109,251"/>
<area shape="poly" title=" " alt="" coords="448,176,123,228,122,223,447,170"/>
<area shape="rect" title=" " alt="" coords="133,225,232,251"/>
<area shape="poly" title=" " alt="" coords="448,179,246,225,245,220,447,174"/>
<area shape="rect" title=" " alt="" coords="256,225,355,251"/>
<area shape="poly" title=" " alt="" coords="464,180,350,223,348,218,462,175"/>
<area shape="rect" title=" " alt="" coords="379,225,482,251"/>
<area shape="poly" title=" " alt="" coords="485,179,452,217,448,213,481,176"/>
<area shape="rect" title=" " alt="" coords="738,225,833,251"/>
<area shape="poly" title=" " alt="" coords="540,174,726,219,724,225,538,180"/>
<area shape="rect" title=" " alt="" coords="506,225,609,251"/>
<area shape="poly" title=" " alt="" coords="506,176,540,213,536,217,502,179"/>
<area shape="rect" title=" " alt="" coords="633,225,714,251"/>
<area shape="poly" title=" " alt="" coords="523,175,632,218,630,223,521,180"/>
<area shape="poly" title=" " alt="" coords="705,175,844,219,843,224,703,180"/>
<area shape="poly" title=" " alt="" coords="769,102,856,144,853,148,766,106"/>
<area shape="poly" title=" " alt="" coords="757,102,830,175,871,214,867,218,826,179,753,106"/>
<area shape="poly" title=" " alt="" coords="1088,107,942,151,941,145,1087,101"/>
<area shape="poly" title=" " alt="" coords="1139,102,1181,141,1177,144,1136,106"/>
<area shape="poly" title=" " alt="" coords="1126,105,1116,141,1106,162,1091,179,1056,203,1017,220,977,230,941,236,940,231,976,225,1015,215,1054,199,1088,175,1101,159,1111,139,1121,104"/>
<area shape="poly" title=" " alt="" coords="1242,103,947,156,946,151,1241,98"/>
<area shape="poly" title=" " alt="" coords="1289,105,1285,141,1277,162,1264,179,1240,194,1206,206,1118,223,1023,233,941,238,941,233,1022,228,1118,218,1205,201,1238,189,1261,175,1273,159,1280,140,1283,104"/>
<area shape="rect" title=" " alt="" coords="1326,152,1477,177"/>
<area shape="poly" title=" " alt="" coords="1305,102,1372,142,1369,147,1303,106"/>
<area shape="rect" title=" " alt="" coords="1501,152,1619,177"/>
<area shape="poly" title=" " alt="" coords="1330,101,1503,146,1502,151,1328,106"/>
<area shape="poly" title=" " alt="" coords="998,106,925,147,922,143,996,102"/>
<area shape="poly" title=" " alt="" coords="1048,102,1159,144,1157,149,1046,107"/>
<area shape="poly" title=" " alt="" coords="1013,106,987,142,968,162,947,180,897,206,847,225,845,220,895,202,944,175,964,158,982,138,1008,103"/>
<area shape="rect" title=" " alt="" coords="1009,152,1077,177"/>
<area shape="poly" title=" " alt="" coords="1024,103,1037,138,1032,140,1019,105"/>
<area shape="poly" title=" " alt="" coords="866,103,882,139,878,141,862,105"/>
<area shape="poly" title=" " alt="" coords="854,106,840,138,837,158,840,176,852,197,868,214,864,218,848,200,835,178,831,158,834,137,849,103"/>
</map>
</div>
</div>
<p><a href="main_8c_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="define-members" name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:ae926ecdafab792fa60f183627cb03f88" id="r_ae926ecdafab792fa60f183627cb03f88"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main_8c.html#ae926ecdafab792fa60f183627cb03f88">MAX_ERROR_COUNT_SDIR</a>&#160;&#160;&#160;10</td></tr>
<tr class="separator:ae926ecdafab792fa60f183627cb03f88"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a43f5e0d6db0fb41a437cc9096b32e9b5" id="r_a43f5e0d6db0fb41a437cc9096b32e9b5"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main_8c.html#a43f5e0d6db0fb41a437cc9096b32e9b5">system_init</a> (void)</td></tr>
<tr class="separator:a43f5e0d6db0fb41a437cc9096b32e9b5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a630544a7f0a2cc40d8a7fefab7e2fe70" id="r_a630544a7f0a2cc40d8a7fefab7e2fe70"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main_8c.html#a630544a7f0a2cc40d8a7fefab7e2fe70">app_main</a> (void)</td></tr>
<tr class="separator:a630544a7f0a2cc40d8a7fefab7e2fe70"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="var-members" name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a5a85b9c772bbeb480b209a3e6ea92b4c" id="r_a5a85b9c772bbeb480b209a3e6ea92b4c"><td class="memItemLeft" align="right" valign="top">static const char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main_8c.html#a5a85b9c772bbeb480b209a3e6ea92b4c">TAG</a> = &quot;MAIN&quot;</td></tr>
<tr class="separator:a5a85b9c772bbeb480b209a3e6ea92b4c"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Macro Definition Documentation</h2>
<a id="ae926ecdafab792fa60f183627cb03f88" name="ae926ecdafab792fa60f183627cb03f88"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae926ecdafab792fa60f183627cb03f88">&#9670;&#160;</a></span>MAX_ERROR_COUNT_SDIR</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define MAX_ERROR_COUNT_SDIR&#160;&#160;&#160;10</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="main_8c_source.html#l00072">72</a> of file <a class="el" href="main_8c_source.html">main.c</a>.</p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="a630544a7f0a2cc40d8a7fefab7e2fe70" name="a630544a7f0a2cc40d8a7fefab7e2fe70"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a630544a7f0a2cc40d8a7fefab7e2fe70">&#9670;&#160;</a></span>app_main()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void app_main </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="main_8c_source.html#l00121">121</a> of file <a class="el" href="main_8c_source.html">main.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  121</span>                    {</div>
<div class="line"><span class="lineno">  122</span> </div>
<div class="line"><span class="lineno">  123</span>    <span class="comment">// Habilitar logs por UART0 (USB) para debug</span></div>
<div class="line"><span class="lineno">  124</span>    esp_log_level_set(<span class="stringliteral">&quot;*&quot;</span>, ESP_LOG_INFO);</div>
<div class="line"><span class="lineno">  125</span> </div>
<div class="line"><span class="lineno">  126</span>    ESP_LOGI(<a class="code hl_variable" href="main_8c.html#a5a85b9c772bbeb480b209a3e6ea92b4c">TAG</a>, <span class="stringliteral">&quot;ESP iniciando...&quot;</span>);</div>
<div class="line"><span class="lineno">  127</span> </div>
<div class="line"><span class="lineno">  128</span>    <span class="comment">// Inicializa Bluetooth, Bluepad32, NVS, etc.</span></div>
<div class="line"><span class="lineno">  129</span>    <span class="comment">// init_bluetooth();</span></div>
<div class="line"><span class="lineno">  130</span> </div>
<div class="line"><span class="lineno">  131</span>    <span class="comment">// Inicia todas las librerias que se necesitan</span></div>
<div class="line"><span class="lineno">  132</span>    <a class="code hl_function" href="main_8c.html#a43f5e0d6db0fb41a437cc9096b32e9b5">system_init</a>();</div>
<div class="line"><span class="lineno">  133</span> </div>
<div class="line"><span class="lineno">  134</span>    <span class="comment">// Creacion de toda las tareas de FreeRTOS</span></div>
<div class="line"><span class="lineno">  135</span>    <span class="comment">// Tareas de libreria de comunicaciones</span></div>
<div class="line"><span class="lineno">  136</span>    <span class="comment">// Tareas de libreria de maquina de estado</span></div>
<div class="line"><span class="lineno">  137</span> </div>
<div class="line"><span class="lineno">  138</span>    <span class="comment">// Ejecutar loop de BTstack (bloquea dentro de app_main, pero otras tareas siguen)</span></div>
<div class="line"><span class="lineno">  139</span>    <span class="comment">//btstack_run_loop_execute();</span></div>
<div class="line"><span class="lineno">  140</span>}</div>
<div class="ttc" id="amain_8c_html_a43f5e0d6db0fb41a437cc9096b32e9b5"><div class="ttname"><a href="main_8c.html#a43f5e0d6db0fb41a437cc9096b32e9b5">system_init</a></div><div class="ttdeci">void system_init(void)</div><div class="ttdef"><b>Definition</b> <a href="main_8c_source.html#l00074">main.c:74</a></div></div>
<div class="ttc" id="amain_8c_html_a5a85b9c772bbeb480b209a3e6ea92b4c"><div class="ttname"><a href="main_8c.html#a5a85b9c772bbeb480b209a3e6ea92b4c">TAG</a></div><div class="ttdeci">static const char * TAG</div><div class="ttdef"><b>Definition</b> <a href="main_8c_source.html#l00035">main.c:35</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a43f5e0d6db0fb41a437cc9096b32e9b5" name="a43f5e0d6db0fb41a437cc9096b32e9b5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a43f5e0d6db0fb41a437cc9096b32e9b5">&#9670;&#160;</a></span>system_init()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void system_init </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="main_8c_source.html#l00074">74</a> of file <a class="el" href="main_8c_source.html">main.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   74</span>                       {</div>
<div class="line"><span class="lineno">   75</span> </div>
<div class="line"><span class="lineno">   76</span>    <span class="comment">// Initialize hardware</span></div>
<div class="line"><span class="lineno">   77</span>    <span class="keywordflow">if</span>(<a class="code hl_function" href="km__gpio_8c.html#a4467a661ca6fe29f12f392cb58b386f3">KM_GPIO_Init</a>() != ESP_OK)</div>
<div class="line"><span class="lineno">   78</span>        ESP_LOGE(<a class="code hl_variable" href="main_8c.html#a5a85b9c772bbeb480b209a3e6ea92b4c">TAG</a>, <span class="stringliteral">&quot;Error inicializando libreria gpio\n&quot;</span>);</div>
<div class="line"><span class="lineno">   79</span> </div>
<div class="line"><span class="lineno">   80</span>    <span class="comment">// Initialize I2C</span></div>
<div class="line"><span class="lineno">   81</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="km__gpio_8c.html#a292bd05e9fda7632e0e0b4aab966d28b">KM_GPIO_I2CInit</a>() != ESP_OK)</div>
<div class="line"><span class="lineno">   82</span>        ESP_LOGE(<a class="code hl_variable" href="main_8c.html#a5a85b9c772bbeb480b209a3e6ea92b4c">TAG</a>, <span class="stringliteral">&quot;Error inicializando libreria i2c\n&quot;</span>);</div>
<div class="line"><span class="lineno">   83</span> </div>
<div class="line"><span class="lineno">   84</span>    <span class="comment">// Initialise tasks</span></div>
<div class="line"><span class="lineno">   85</span>    <a class="code hl_function" href="km__rtos_8c.html#a63ebe5189542c7e70e5d52b54bd416d5">KM_RTOS_Init</a>();</div>
<div class="line"><span class="lineno">   86</span> </div>
<div class="line"><span class="lineno">   87</span>    <span class="comment">// Initialise comunications on UART0 (USB to Orin)</span></div>
<div class="line"><span class="lineno">   88</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="km__coms_8c.html#ab76bebe5e423f1067e670d62a730e721">KM_COMS_Init</a>(UART_NUM_0) != ESP_OK)</div>
<div class="line"><span class="lineno">   89</span>        ESP_LOGE(<a class="code hl_variable" href="main_8c.html#a5a85b9c772bbeb480b209a3e6ea92b4c">TAG</a>, <span class="stringliteral">&quot;Error inicializando libreria de comunicaciones&quot;</span>);</div>
<div class="line"><span class="lineno">   90</span>    </div>
<div class="line"><span class="lineno">   91</span>    <span class="comment">// KM_SDIR_Init(MAX_ERROR_COUNT_SDIR);</span></div>
<div class="line"><span class="lineno">   92</span> </div>
<div class="line"><span class="lineno">   93</span>    <span class="comment">// KM_ACT_Begin();</span></div>
<div class="line"><span class="lineno">   94</span>    <span class="comment">// KM_PID_Init();</span></div>
<div class="line"><span class="lineno">   95</span> </div>
<div class="line"><span class="lineno">   96</span>    <span class="comment">// Test bidirectional: send heartbeat + receive from Orin</span></div>
<div class="line"><span class="lineno">   97</span>    uint8_t payload[4] = {0xDE, 0xAD, 0xBE, 0xEF};</div>
<div class="line"><span class="lineno">   98</span>    uint32_t loop_count = 0;</div>
<div class="line"><span class="lineno">   99</span> </div>
<div class="line"><span class="lineno">  100</span>    <span class="keywordflow">while</span> (<span class="keyword">true</span>) {</div>
<div class="line"><span class="lineno">  101</span>        <span class="comment">// TX: send heartbeat to Orin every 10 iterations (~1s)</span></div>
<div class="line"><span class="lineno">  102</span>        <span class="keywordflow">if</span> (loop_count % 10 == 0) {</div>
<div class="line"><span class="lineno">  103</span>            <a class="code hl_function" href="km__coms_8c.html#a1761afbf51adcb8c23f3c6b5e0db2ead">KM_COMS_SendMsg</a>(<a class="code hl_enumvalue" href="km__coms_8h.html#a78b97fef55da786a15a849fd9d7e557ca41bbcc90bbab89a5de8fb6a87eb8b1de">ESP_HEARTBEAT</a>, payload, <span class="keyword">sizeof</span>(payload));</div>
<div class="line"><span class="lineno">  104</span>            ESP_LOGI(<a class="code hl_variable" href="main_8c.html#a5a85b9c772bbeb480b209a3e6ea92b4c">TAG</a>, <span class="stringliteral">&quot;TX: heartbeat sent&quot;</span>);</div>
<div class="line"><span class="lineno">  105</span>        }</div>
<div class="line"><span class="lineno">  106</span> </div>
<div class="line"><span class="lineno">  107</span>        <span class="comment">// RX: read bytes from UART2 into internal buffer</span></div>
<div class="line"><span class="lineno">  108</span>        <a class="code hl_function" href="km__coms_8c.html#a88b2405843415e6bf9a03b36048890d4">km_coms_ReceiveMsg</a>();</div>
<div class="line"><span class="lineno">  109</span> </div>
<div class="line"><span class="lineno">  110</span>        <span class="comment">// RX: parse complete frames and dispatch to objects</span></div>
<div class="line"><span class="lineno">  111</span>        <a class="code hl_function" href="km__coms_8c.html#ac4c6ccd77f6a2289dc69ff18629e516f">KM_COMS_ProccessMsgs</a>();</div>
<div class="line"><span class="lineno">  112</span> </div>
<div class="line"><span class="lineno">  113</span>        loop_count++;</div>
<div class="line"><span class="lineno">  114</span>        vTaskDelay(pdMS_TO_TICKS(100));</div>
<div class="line"><span class="lineno">  115</span>    }</div>
<div class="line"><span class="lineno">  116</span>}</div>
<div class="ttc" id="akm__coms_8c_html_a1761afbf51adcb8c23f3c6b5e0db2ead"><div class="ttname"><a href="km__coms_8c.html#a1761afbf51adcb8c23f3c6b5e0db2ead">KM_COMS_SendMsg</a></div><div class="ttdeci">int KM_COMS_SendMsg(message_type_t type, uint8_t *payload, uint8_t len)</div><div class="ttdoc">Sends a communication message over UART.</div><div class="ttdef"><b>Definition</b> <a href="km__coms_8c_source.html#l00103">km_coms.c:103</a></div></div>
<div class="ttc" id="akm__coms_8c_html_a88b2405843415e6bf9a03b36048890d4"><div class="ttname"><a href="km__coms_8c.html#a88b2405843415e6bf9a03b36048890d4">km_coms_ReceiveMsg</a></div><div class="ttdeci">void km_coms_ReceiveMsg(void)</div><div class="ttdoc">Reads bytes from the UART and stores them into the internal RX buffer.</div><div class="ttdef"><b>Definition</b> <a href="km__coms_8c_source.html#l00148">km_coms.c:148</a></div></div>
<div class="ttc" id="akm__coms_8c_html_ab76bebe5e423f1067e670d62a730e721"><div class="ttname"><a href="km__coms_8c.html#ab76bebe5e423f1067e670d62a730e721">KM_COMS_Init</a></div><div class="ttdeci">esp_err_t KM_COMS_Init(uart_port_t uart_port)</div><div class="ttdoc">Initializes the KM_COMS communication library for a given UART port.</div><div class="ttdef"><b>Definition</b> <a href="km__coms_8c_source.html#l00080">km_coms.c:80</a></div></div>
<div class="ttc" id="akm__coms_8c_html_ac4c6ccd77f6a2289dc69ff18629e516f"><div class="ttname"><a href="km__coms_8c.html#ac4c6ccd77f6a2289dc69ff18629e516f">KM_COMS_ProccessMsgs</a></div><div class="ttdeci">void KM_COMS_ProccessMsgs(void)</div><div class="ttdoc">Processes all received messages from the RX buffer.</div><div class="ttdef"><b>Definition</b> <a href="km__coms_8c_source.html#l00181">km_coms.c:181</a></div></div>
<div class="ttc" id="akm__coms_8h_html_a78b97fef55da786a15a849fd9d7e557ca41bbcc90bbab89a5de8fb6a87eb8b1de"><div class="ttname"><a href="km__coms_8h.html#a78b97fef55da786a15a849fd9d7e557ca41bbcc90bbab89a5de8fb6a87eb8b1de">ESP_HEARTBEAT</a></div><div class="ttdeci">@ ESP_HEARTBEAT</div><div class="ttdef"><b>Definition</b> <a href="km__coms_8h_source.html#l00097">km_coms.h:97</a></div></div>
<div class="ttc" id="akm__gpio_8c_html_a292bd05e9fda7632e0e0b4aab966d28b"><div class="ttname"><a href="km__gpio_8c.html#a292bd05e9fda7632e0e0b4aab966d28b">KM_GPIO_I2CInit</a></div><div class="ttdeci">esp_err_t KM_GPIO_I2CInit(void)</div><div class="ttdoc">Initialize I2C master interface.</div><div class="ttdef"><b>Definition</b> <a href="km__gpio_8c_source.html#l00279">km_gpio.c:279</a></div></div>
<div class="ttc" id="akm__gpio_8c_html_a4467a661ca6fe29f12f392cb58b386f3"><div class="ttname"><a href="km__gpio_8c.html#a4467a661ca6fe29f12f392cb58b386f3">KM_GPIO_Init</a></div><div class="ttdeci">esp_err_t KM_GPIO_Init(void)</div><div class="ttdoc">Initialize all hardware peripherals needed by KM_GPIO.</div><div class="ttdef"><b>Definition</b> <a href="km__gpio_8c_source.html#l00179">km_gpio.c:179</a></div></div>
<div class="ttc" id="akm__rtos_8c_html_a63ebe5189542c7e70e5d52b54bd416d5"><div class="ttname"><a href="km__rtos_8c.html#a63ebe5189542c7e70e5d52b54bd416d5">KM_RTOS_Init</a></div><div class="ttdeci">void KM_RTOS_Init(void)</div><div class="ttdoc">Initializes the RTOS task system.</div><div class="ttdef"><b>Definition</b> <a href="km__rtos_8c_source.html#l00047">km_rtos.c:47</a></div></div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a id="a5a85b9c772bbeb480b209a3e6ea92b4c" name="a5a85b9c772bbeb480b209a3e6ea92b4c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5a85b9c772bbeb480b209a3e6ea92b4c">&#9670;&#160;</a></span>TAG</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">const char* TAG = &quot;MAIN&quot;</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="main_8c_source.html#l00035">35</a> of file <a class="el" href="main_8c_source.html">main.c</a>.</p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8
</small></address>
</body>
</html>
